@inherits UmbracoViewPage<ArticleListPage>
@using ContentModels = Umbraco.Cms.Web.Common.PublishedModels;
@using GI.BackOffice
@using GI.BackOffice.Models.ViewModelsData
@using Umbraco.Cms.Core.Models
@{
    Layout = "Master.cshtml";
}


@{
    var currentPage = 1;
    if (Context.Request.Query.TryGetValue("page", out var rawPageValue))
    {
        int.TryParse(rawPageValue, out currentPage);
    }

    var articlePage = Umbraco.Content(Guid.Parse("c606cba8-dfeb-4db5-99be-e297710fe601"))
        .Children()
        .Where(x => x.IsVisible())
        .Skip((currentPage - 1) * 6)
        .Take(6)
        .ToList();

    var articlesCount = Umbraco
        .Content(Guid.Parse("c606cba8-dfeb-4db5-99be-e297710fe601"))
        .Children()
        .Count(x => x.IsVisible());

    var homePage = Model.Ancestor<HomePage>();

    var topImage = homePage?.Value<MediaWithCrops<Image>>("topImage");
    var bottomImage = homePage?.Value<MediaWithCrops<Image>>("bottomImage");

    <img class="nk-page-background-top" src="@topImage?.GetUrlWebp()" alt="">
    <img class="nk-page-background-bottom" src="@bottomImage?.GetUrlWebp()" alt="">

    var history = new BreadcrumbViewData
    {
        History = new LinkedList<BreadcrumbJumpViewData>(new List<BreadcrumbJumpViewData>
        {
            new()
            {
                Title = "Головна",
                Url = "/"
            },
            new()
            {
                Title = "Публікації",
                Url = "/"
            }
        })
    };
}

<!-- Main Content-->
<div class="nk-gap-1"></div>

<div class="container">
    @await Html.PartialAsync("~/Views/Partials/breadcrumb.cshtml", history)
    <div class="nk-blog-grid">
        <div class="row are-images-unloaded">

            @await Html.PartialAsync("~/Views/Partials/articles/grid/default.cshtml", articlePage)

        </div>

        <div class="nk-gap-2"></div>

        <div class="nk-pagination-center">
            @await Html.PartialAsync("~/Views/Partials/articles/pagination.cshtml", new PaginationViewData
            {
                PageSize = 6,
                TotalCount = articlesCount,
            })
        </div>

    </div>
</div>